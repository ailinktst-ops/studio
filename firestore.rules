rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * FIRESTORE SECURITY RULES
     *
     * Core Philosophy:
     * This ruleset implements an open-read/authenticated-write model designed for a real-time 
     * counter and ranking application. The primary goal is to allow any user (including 
     * unauthenticated "overlay" views) to read data while restricting modification 
     * to authenticated users.
     *
     * Data Structure:
     * - /counters/{counterId}: The primary document containing counter metadata and denormalized participant stats.
     * - /counters/{counterId}/participants/{participantId}: Granular participant records for detailed updates.
     */

    match /counters/{counterId} {
      // Permite que qualquer pessoa (mesmo sem login) veja o ranking e o telão
      allow read: if true;
      
      // Restringe a escrita apenas a usuários autenticados (Admin ou Participantes via AuthInitializer)
      allow write: if request.auth != null;

      match /participants/{participantId} {
        // Segue a mesma lógica para a sub-coleção de participantes
        allow read: if true;
        allow write: if request.auth != null;
      }
    }

  }
}